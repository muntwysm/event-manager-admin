<div class="requirement">
<% new_or_existing = requirement.new_record? ? 'new' : 'existing' %>
<% prefix = "event[#{new_or_existing}_requirement_attributes][]" %>

	<% fields_for prefix, requirement do |requirement_form| %>
		<p>
			<% if new_or_existing == "existing" %>
			Item:
				<%= requirement_form.collection_select(:item_id, Item.find(:all), :id, :name_with_unit, :include_blank => true) %>
		  Qty:
		  <%= requirement_form.text_field :qty %>
		  <%= link_to_function "remove", "$(this).up('.requirement').remove()" %>
			<% elsif Item.not_yet_required(params[:id]).count > 0 %>
			Item:			
				<%= requirement_form.collection_select(:item_id, Item.not_yet_required(params[:id]), :id, :name_with_unit, :include_blank => true) %>
		  Qty:
		  <%= requirement_form.text_field :qty %>
		  <%= link_to_function "remove", "$(this).up('.requirement').remove()" %>
			<% end %>
		</p>
	<% end %>

</div>
